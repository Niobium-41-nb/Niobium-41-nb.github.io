<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACM恋爱物语 - nowcoder-galgame</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }
        
        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .game-header {
            height: 60px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 2px solid #4a90e2;
        }
        
        .game-content {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        .bg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .bg-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.7);
        }
        
        .character-container {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            width: 400px;
            height: 600px;
            display: flex;
            align-items: flex-end;
        }
        
        .character-image {
            height: 100%;
            object-fit: contain;
            transition: all 0.5s ease;
        }
        
        .dialogue-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            border-top: 2px solid #4a90e2;
            padding: 20px;
            display: flex;
            z-index: 2;
        }
        
        .avatar-container {
            margin-right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #4a90e2;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .dialogue-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .name-box {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a90e2;
        }
        
        .dialogue-box {
            flex: 1;
            font-size: 24px;
            line-height: 1.5;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        
        .dialogue-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .dialogue-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dialogue-box::-webkit-scrollbar-thumb {
            background: rgba(74, 144, 226, 0.5);
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .settings-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .settings-button:hover {
            background-color: rgba(74, 144, 226, 0.3);
        }
        
        .settings-panel {
            position: absolute;
            top: 50px;
            right: 10px;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 20px;
            z-index: 101;
            display: none;
        }
        
        .settings-title {
            font-size: 20px;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .setting-item {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            font-size: 16px;
            color: white;
            margin-bottom: 8px;
        }
        
        .setting-slider {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .setting-value {
            display: block;
            text-align: center;
            font-size: 14px;
            color: #4a90e2;
        }
        
        .setting-select {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .setting-select:focus {
            border-color: #5aa0f2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
        }
        
        .setting-select option {
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
        }
        
        .music-toggle-button {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .music-toggle-button:hover {
            background-color: rgba(74, 144, 226, 0.3);
            border-color: #5aa0f2;
        }
        
        .music-toggle-button.playing {
            background-color: rgba(74, 144, 226, 0.2);
        }
        
        .close-settings {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .close-settings:hover {
            color: #4a90e2;
        }
        
        .control-button {
            padding: 10px 20px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .control-button:hover {
            background-color: #357abd;
        }
        
        .choices-container {
            position: absolute;
            bottom: 200px;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 3;
        }
        
        .choice-button {
            padding: 15px 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            text-align: center;
            width: 50%;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        
        .choice-button:hover {
            background-color: rgba(74, 144, 226, 0.2);
            border-color: #5aa0f2;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .typewriter {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 3s steps(40, end);
        }
        
        @keyframes typing {
            from {
                width: 0;
            }
            to {
                width: 100%;
            }
        }
        
        .game-start {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .game-title {
            font-size: 48px;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
        }
        
        .game-subtitle {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 60px;
        }
        
        .name-input-container {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .name-label {
            display: block;
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 15px;
        }
        
        .name-input {
            padding: 12px 20px;
            font-size: 20px;
            width: 300px;
            border: 2px solid #4a90e2;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .name-input:focus {
            border-color: #5aa0f2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
            background-color: rgba(0, 0, 0, 0.9);
        }
        
        .name-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .start-button {
            padding: 15px 40px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .start-button:hover {
            background-color: #357abd;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            ACM恋爱物语 - nowcoder-galgame
        </div>
        <div class="game-content">
            <button class="settings-button" onclick="toggleSettings()">设置</button>
            
            <div class="settings-panel" id="settingsPanel">
                <h3 class="settings-title">游戏设置</h3>
                <button class="close-settings" onclick="toggleSettings()">×</button>
                <div class="setting-item">
                    <label class="setting-label">文本速度</label>
                    <input type="range" class="setting-slider" id="typingSpeedSlider" min="10" max="100" value="30" step="5">
                    <span class="setting-value" id="typingSpeedValue">30ms</span>
                </div>
                <div class="setting-item">
                    <label class="setting-label">背景音乐</label>
                    <button class="music-toggle-button" id="musicToggle" onclick="toggleMusic()">开启音乐</button>
                </div>
                <div class="setting-item">
                    <label class="setting-label">选择音乐</label>
                    <select class="setting-select" id="musicSelect" onchange="setCurrentMusic(this.value)">
                        <option value="0">P1 - Summer Pockets - 水月陵</option>
                        <option value="1">P2 - low tide - どんまる</option>
                        <option value="2">P3 - Wings of Courage ピアノアレンジ1</option>
                        <option value="3">P4 - 想いのカタチ - sawamurah</option>
                        <option value="4">P5 - 星月夜 - 忍</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label class="setting-label">音量</label>
                    <input type="range" class="setting-slider" id="volumeSlider" min="0" max="100" value="50" step="1">
                    <span class="setting-value" id="volumeValue">50%</span>
                </div>
                <div class="setting-item" style="text-align: center; margin-top: 20px;">
                    <button class="control-button" onclick="saveGame()" style="margin-right: 10px;">保存游戏</button>
                    <button class="control-button" onclick="loadGame()">加载游戏</button>
                </div>
            </div>
            
            <div class="bg-container">
                <img class="bg-image" src="game/images/bg/bg%20classroom.png" alt="背景">
            </div>
            <div class="character-container">
                <img class="character-image" src="game/images/nk-girl/微笑.jpg" alt="牛客娘">
            </div>
            <div class="dialogue-container">
                <div class="avatar-container">
                    <img class="avatar-image" src="game/images/chen/chen%20happy.png" alt="角色头像">
                </div>
                <div class="dialogue-content">
                    <div class="name-box">林晨</div>
                    <div class="dialogue-box">九月午后，阳光透过窗户洒在课桌上。黑板上写着"编程基础朋辈辅导"几个大字。教室里零星坐着几位新生，我坐在讲台旁整理资料。</div>
                    <div class="controls">
                        <button class="control-button" onclick="nextDialogue()">下一句</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="game-start" id="gameStart">
        <div class="game-title">ACM恋爱物语</div>
        <div class="game-subtitle">nowcoder-galgame</div>
        <div class="name-input-container">
            <label for="playerName" class="name-label">请输入你的名字：</label>
            <input type="text" id="playerName" class="name-input" placeholder="林晨">
        </div>
        <button class="start-button" onclick="startGame()">开始游戏</button>
    </div>
    
    <!-- 背景音乐元素 -->
    <audio id="bgMusic" loop preload="auto">
        <source src="game/music/P1%20-%20Summer%20Pockets%20-%20%E6%B0%B4%E6%9C%88%E9%99%B5.mp3" type="audio/mpeg">
        您的浏览器不支持音频元素。
    </audio>
    
    <script>
        // 游戏状态
        let currentScene = 0;
        let showChoices = false;
        let gameStarted = false;
        let choiceHistory = [];
        let isTyping = false;
        let typingSpeed = 30; // 打字机速度，单位ms
        let typingInterval = null;
        let playerName = "林晨"; // 默认玩家名字
        
        // 音乐状态
        let bgMusic = null;
        let isMusicPlaying = true; // 默认音乐开启
        let musicVolume = 0.5; // 默认音量50%
        let currentMusicIndex = 0;
        
        // 音乐文件列表
        const musicList = [
            "game/music/P1%20-%20Summer%20Pockets%20-%20%E6%B0%B4%E6%9C%88%E9%99%B5.mp3",
            "game/music/P2%20-%20low%20tide%20-%20%E3%81%A9%E3%82%93%E3%81%BE%E3%82%8B.mp3",
            "game/music/P3%20-%20Wings%20of%20Courage%20%E3%83%94%E3%82%A2%E3%83%8E%E3%82%A2%E3%83%AC%E3%83%B3%E3%82%B81%20-%20Elements%20Garden.mp3",
            "game/music/P4%20-%20%E6%83%B3%E3%81%84%E3%81%AE%E3%82%AB%E3%82%BF%E3%83%81%E3%80%80-%20sawamurah.mp3",
            "game/music/P5%20-%20%E6%98%9F%E6%9C%88%E5%A4%9C%20-%20%E5%BF%8D.mp3"
        ];
        
        // 剧情数据
        const scenes = [
            // 序章：相遇
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "九月午后，阳光透过窗户洒在课桌上。黑板上写着\"编程基础朋辈辅导\"几个大字。教室里零星坐着几位新生，我坐在讲台旁整理资料。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "作为计算机系大三学生，我自愿担任朋辈辅导的助教。希望能帮助新生们更好地适应编程学习。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/抱歉.jpg",
                name: "牛客娘",
                dialogue: "抱歉……我来晚了，请问这里是计算机系的朋辈辅导教室吗？我是新生牛客娘。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "坐吧，刚讲到变量定义，我补讲一遍重点。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "辅导课进行中，牛客娘全程低头记笔记。偶尔皱眉停顿，会把疑问快速写在便签上。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/提问不发代码，只能给你算一卦.png",
                name: "牛客娘",
                dialogue: "林晨学长，我……我不太懂循环结构的逻辑，你能再讲一下吗？"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "没问题，你看这个例题——先定义循环条件，再拆解执行步骤。就像你记笔记的逻辑，一步步梳理就通了。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "夕阳斜照进教室，两人凑在课桌前看屏幕，影子叠在一起。"
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "后续一周，牛客娘每天提前20分钟到教室预习。课后留下刷题，我会主动帮她拓展思路。"
            },
            // 选择点1
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "在帮助她的方式上，我做出了选择。",
                choices: [
                    {
                        text: "从基础概念开始，一步步详细讲解",
                        nextScene: 10
                    },
                    {
                        text: "通过例题引导她自己发现问题所在",
                        nextScene: 10
                    },
                    {
                        text: "先讲解核心思路，再让她独立完成练习",
                        nextScene: 10
                    }
                ]
            },
            {
                bg: "game/images/bg/bg classroom.png",
                character: "game/images/nk-girl/高兴.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，你的笔记好清晰，我都看懂了！"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "周末傍晚，我们一起走出计算机楼。梧桐叶落在肩头，夕阳把影子拉得很长。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "谢谢林晨学长一直帮我，不然我肯定跟不上进度。朋辈辅导有你真的太好了~"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "你很努力，逻辑感也强，不用谢。以后有问题，随时找我。"
            },
            // 第一章：ACM招新
            {
                bg: "game/images/bg/bg club.png",
                character: "game/images/nk-girl/来打比赛.jpg",
                name: "林晨",
                dialogue: "新学期开始，ACM俱乐部开始招新。作为俱乐部的核心成员，我负责技术考核部分。"
            },
            {
                bg: "game/images/bg/bg club.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "考核现场，牛客娘紧张地握着笔，眼神专注地看着题目。我注意到她的手指微微颤抖，但思路却很清晰。"
            },
            // 第二章：深夜训练
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/卡住了.jpg",
                name: "林晨",
                dialogue: "深夜，训练室只剩我和牛客娘。她对着屏幕上的题目皱眉，手指悬在键盘上，迟迟没有敲下。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/太难了.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，这道题我试了三种思路，都超时了……是不是我太笨了，根本不适合算法竞赛？"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "别急，先看看你的代码。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "我拉过椅子，坐在她身边，仔细分析她的代码：\"这里的时间复杂度是O(n²)，数据规模大时肯定会超时。试试用滑动窗口优化，把复杂度降到O(n)。\""
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "AC了！林晨学长，我懂了！原来优化思路这么巧妙，我之前完全没想到！"
            },
            // 第一次模拟赛
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油1.jpg",
                name: "林晨",
                dialogue: "第一次模拟赛，牛客娘紧张得手心冒汗。比赛开始，她盯着题目，迟迟没有动笔。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油1.jpg",
                name: "林晨",
                dialogue: "我注意到她的状态，递过一张纸条：\"别紧张，按平时训练的思路来，先读题，再想算法，最后写代码。\""
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/WA了.jpg",
                name: "牛客娘",
                dialogue: "怎么会WA……明明样例都过了……"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "时间一分一秒过去，她越来越急。我走到她身后，轻声提醒：\"检查边界条件，特别是数组下标和循环终止条件。\""
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，谢谢你！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "比赛结束，牛客娘解出2题，排名中游。她看着成绩单，既欣慰又失落。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/哭泣1.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，我只解出2题，是不是很差劲？其他队友都能解出3题以上……"
            },
            // 选择点2
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/哭泣1.jpg",
                name: "林晨",
                dialogue: "我选择了安慰她的方式：",
                choices: [
                    {
                        text: "第一次模拟赛能解出2题已经很棒了，很多新生都没你做得好。",
                        nextScene: 29
                    },
                    {
                        text: "别灰心，我们一起分析今天的错题，针对性加强练习。",
                        nextScene: 29
                    },
                    {
                        text: "你看，你现在已经能独立解出2题了，比上周进步太多了。",
                        nextScene: 29
                    }
                ]
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "牛客娘",
                dialogue: "嗯！林晨学长，我会继续努力的！下次模拟赛，我一定要解出3题！"
            },
            // 深夜训练继续
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/卡住了.jpg",
                name: "林晨",
                dialogue: "深夜训练继续。牛客娘刷题到凌晨，我在旁边陪她。偶尔递上一杯热牛奶，提醒她休息。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/卡住了.jpg",
                name: "牛客娘",
                dialogue: "这道题……我卡了整整一个小时了。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "让我看看。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "我凑过去，发现是一个复杂的动态规划问题。我画图解释状态转移方程，牛客娘专注地听着。几分钟后，她眼睛一亮。"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "我明白了！原来可以这样优化！"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "她快速敲击键盘，代码一气呵成。提交——AC了！"
            },
            {
                bg: "game/images/bg/bg room.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "牛客娘",
                dialogue: "太好了！又解决了一道难题！林晨学长，谢谢你一直陪着我。"
            },
            // 第三章：区域赛
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油1.jpg",
                name: "林晨",
                dialogue: "区域赛现场，气氛紧张。牛客娘第一次参加正式比赛，手心全是汗。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油1.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，我好紧张……要是拖了队伍后腿怎么办？"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "林晨",
                dialogue: "别怕，按平时训练来，你能行。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "林晨",
                dialogue: "比赛开始。牛客娘专注读题，很快解出第一题。第二题却卡住了，反复提交都是WA。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/WA了.jpg",
                name: "牛客娘",
                dialogue: "怎么会……明明思路没错……"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "我走到她身边，快速浏览她的代码：\"这里，数组开小了，题目说n最大是10^5，你只开了10^4。\""
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "啊！我太粗心了！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "她赶紧修改，重新提交——AC了。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "谢谢林晨学长！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "比赛进行到后半段，一道难题难住了所有人。牛客娘盯着题目，突然眼睛一亮。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/有思路了.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，这道题可以用线段树优化！我想到一个解法，但不确定对不对……"
            },
            // 选择点3
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/有思路了.jpg",
                name: "林晨",
                dialogue: "我选择了回应方式：",
                choices: [
                    {
                        text: "相信你的直觉，线段树解法很有创意，写出来试试。",
                        nextScene: 54
                    },
                    {
                        text: "我们再快速推导一遍，确保时间复杂度没问题。",
                        nextScene: 54
                    },
                    {
                        text: "先写核心逻辑，遇到问题我们再一起调整。",
                        nextScene: 54
                    }
                ]
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/TLE了.jpg",
                name: "牛客娘",
                dialogue: "代码写完，提交——TLE了。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/TLE了.jpg",
                name: "牛客娘",
                dialogue: "还是不行……"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "别灰心，看看哪里可以优化。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "林晨",
                dialogue: "我们一起分析，发现一处冗余计算。优化后再次提交——AC了！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "AC了！林晨学长，我们做到了！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "比赛结束，我们队解出5题，排名中上。牛客娘看着成绩单，既开心又遗憾。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "赛后，我们坐在操场看台上。夜空星星点点。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，我今天犯了好多低级错误……要不是你提醒，我可能连第二题都过不了。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "第一次正式比赛，紧张很正常。你已经很棒了，那道线段树题，是你想出来的解法。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/高兴.jpg",
                name: "牛客娘",
                dialogue: "真的吗？其实我昨晚复习到很晚，专门看了线段树的模板……"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "努力会有回报的。下次比赛，你会更出色。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "牛客娘",
                dialogue: "嗯！林晨学长，谢谢你一直陪着我。我会继续努力，不让你失望！"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，这个送给你。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "这是？"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "是我自己做的，感谢你一直以来的指导。希望它能给你带来好运～"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "谢谢，我会好好珍惜的。"
            },
            // 第四章：国赛
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "林晨",
                dialogue: "国赛现场，气氛凝重。牛客娘经过一年的训练，已经成长为队里的主力。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，这次我们一定要拿金牌！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "林晨",
                dialogue: "嗯，一起加油。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "比赛开始。我们配合默契，很快解出前三题。第四题是道难题，卡住了很多队伍。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/有思路了.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，这道题我有点思路，但不确定……可能需要用到动态规划加状压，但状态转移方程很复杂。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "说说你的想法。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "林晨",
                dialogue: "我认真倾听她的分析。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/思考中.jpg",
                name: "牛客娘",
                dialogue: "我觉得可以这样定义状态……"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/有思路了.jpg",
                name: "林晨",
                dialogue: "很棒的想法，我们试试。"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "林晨",
                dialogue: "我们分工合作，她写核心算法，我负责调试优化。一个小时后，代码完成，提交——AC了！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/AC了.jpg",
                name: "牛客娘",
                dialogue: "AC了！林晨学长，我们做到了！"
            },
            {
                bg: "game/images/bg/bg competition.png",
                character: "game/images/nk-girl/捧杯了.jpg",
                name: "林晨",
                dialogue: "比赛结束，我们队解出6题，排名前列。颁奖仪式上，我们拿到了金牌。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "庆功宴后，我们走在回酒店的路上。月光洒在石板路上，安静美好。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，还记得一年前吗？我连循环结构都搞不懂，是你一点一点教我。现在，我们居然一起拿了国赛金牌……"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "是你自己努力的结果。你很聪明，也很坚韧，这一年进步飞快。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "那是因为有你在。每次我想放弃的时候，你都在我身边鼓励我。每次我卡题的时候，你都会耐心帮我分析。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "月光下，她的眼睛亮晶晶的。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "林晨学长，我……我喜欢你。不是学生对老师的喜欢，也不是队友对队长的喜欢。是女生对男生的喜欢。"
            },
            // 选择点4
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "我听到这句话，心跳加速。我该如何回应？",
                choices: [
                    {
                        text: "我也喜欢你，从第一次见你认真记笔记的样子就心动了。",
                        nextScene: 85
                    },
                    {
                        text: "谢谢你的喜欢，但我现在更专注于比赛和学习。",
                        nextScene: 91
                    },
                    {
                        text: "我对你也有好感，我们可以试着从队友发展成恋人。",
                        nextScene: 96
                    }
                ]
            },
            // 好结局：并肩同行
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/高兴.jpg",
                name: "牛客娘",
                dialogue: "真的吗？林晨学长……"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/高兴.jpg",
                name: "林晨",
                dialogue: "我也喜欢你，从第一次见面就喜欢了。看你认真记笔记的样子，看你解出题目时开心的样子，看你一步步成长的样子……每一个瞬间，都让我心动。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "林晨",
                dialogue: "以后，我们不仅是队友，还是恋人。一起刷题，一起比赛，一起走向更远的未来。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "牛客娘",
                dialogue: "嗯！"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "林晨",
                dialogue: "月光下，我们相拥。ACM竞赛的路上，多了一个并肩同行的人。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/比心.jpg",
                name: "系统",
                dialogue: "【好结局：并肩同行】牛客娘和林晨成为恋人，继续在ACM竞赛中创造佳绩。他们的故事，才刚刚开始。"
            },
            // 普通结局：队友与朋友
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "我明白了，林晨学长。学业和比赛确实更重要。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "我们还是最好的队友，一起努力冲击世界赛。等我们都准备好的时候，再来考虑其他事情。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "牛客娘",
                dialogue: "嗯！我会更加努力的，不让你失望！"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "林晨",
                dialogue: "月光下，我们击掌约定。ACM竞赛的路上，我们依然是最默契的队友。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/加油.jpg",
                name: "系统",
                dialogue: "【普通结局：队友与朋友】牛客娘和林晨保持着默契的队友关系，一起为世界赛努力。他们的故事，在ACM的赛场上继续书写。"
            },
            // 友情结局：慢慢发展
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "好啊，我们先从朋友做起。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "我也觉得这样更好。我们可以先一起刷题，一起比赛，慢慢了解彼此。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "牛客娘",
                dialogue: "嗯！我会耐心等待的，林晨学长。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "林晨",
                dialogue: "月光下，我们相视而笑。ACM竞赛的路上，多了一份微妙的情感。"
            },
            {
                bg: "game/images/bg/bg campus.png",
                character: "game/images/nk-girl/微笑.jpg",
                name: "系统",
                dialogue: "【友情结局：慢慢发展】牛客娘和林晨从朋友做起，感情在日常的相处中慢慢升温。他们的故事，在时间的沉淀中愈发美好。"
            }
        ];
        
        // 开始游戏
        function startGame() {
            // 获取玩家输入的名字
            const nameInput = document.getElementById('playerName');
            if (nameInput && nameInput.value.trim()) {
                playerName = nameInput.value.trim();
            }
            
            const gameStartElement = document.getElementById('gameStart');
            if (gameStartElement) {
                gameStartElement.style.display = 'none';
            }
            gameStarted = true;
            currentScene = 0;
            updateScene();
        }
        
        // 更新场景
        function updateScene() {
            if (currentScene >= scenes.length) {
                return;
            }
            
            const scene = scenes[currentScene];
            
            // 更新背景
            document.querySelector('.bg-image').src = scene.bg;
            
            // 更新角色
            document.querySelector('.character-image').src = scene.character;
            
            // 更新头像
            const avatarImage = document.querySelector('.avatar-image');
            if (avatarImage) {
                // 根据角色名字设置头像
                if (scene.name === '林晨') {
                    avatarImage.src = 'game/images/chen/chen happy.png';
                } else if (scene.name === '牛客娘') {
                    avatarImage.src = 'game/images/nk-girl/微笑.jpg';
                } else if (scene.name === '系统') {
                    avatarImage.src = 'game/images/bg/bg classroom.png';
                } else {
                    // 默认头像
                    avatarImage.src = 'game/images/chen/chen happy.png';
                }
            }
            
            // 更新对话
            let displayName = scene.name;
            // 如果是玩家角色（默认是"林晨"），使用自定义名字
            if (scene.name === '林晨') {
                displayName = playerName;
            }
            document.querySelector('.name-box').textContent = displayName;
            
            // 使用打字机效果显示文本，替换对话中的默认名字
            let displayDialogue = scene.dialogue;
            // 替换所有出现的"林晨"为玩家自定义名字
            displayDialogue = displayDialogue.replace(/林晨/g, playerName);
            // 替换所有出现的"林晨学长"为玩家自定义名字+学长
            displayDialogue = displayDialogue.replace(/林晨学长/g, playerName + '学长');
            typeWriter(displayDialogue);
            
            // 检查是否有选择
            if (scene.choices) {
                showChoices = true;
                // 等打字完成后再显示选择
                setTimeout(() => {
                    createChoices(scene.choices);
                }, scene.dialogue.length * typingSpeed);
            } else {
                showChoices = false;
                removeChoices();
            }
        }
        
        // 打字机效果
        function typeWriter(text) {
            isTyping = true;
            let index = 0;
            const dialogueBox = document.querySelector('.dialogue-box');
            dialogueBox.textContent = '';
            
            // 清除之前的打字间隔
            if (typingInterval) {
                clearInterval(typingInterval);
            }
            
            typingInterval = setInterval(() => {
                if (index < text.length) {
                    dialogueBox.textContent += text.charAt(index);
                    index++;
                } else {
                    clearInterval(typingInterval);
                    typingInterval = null;
                    isTyping = false;
                }
            }, typingSpeed);
        }
        
        // 创建选择按钮
        function createChoices(choices) {
            removeChoices();
            
            const choicesContainer = document.createElement('div');
            choicesContainer.className = 'choices-container';
            
            choices.forEach((choice, index) => {
                const choiceButton = document.createElement('button');
                choiceButton.className = 'choice-button';
                choiceButton.textContent = choice.text;
                choiceButton.onclick = () => {
                    // 记录选择
                    choiceHistory.push({
                        scene: currentScene,
                        choice: index
                    });
                    currentScene = choice.nextScene;
                    showChoices = false;
                    removeChoices();
                    updateScene();
                };
                choicesContainer.appendChild(choiceButton);
            });
            
            document.querySelector('.game-content').appendChild(choicesContainer);
        }
        
        // 移除选择按钮
        function removeChoices() {
            const choicesContainer = document.querySelector('.choices-container');
            if (choicesContainer) {
                choicesContainer.remove();
            }
        }
        
        // 下一句对话
        function nextDialogue() {
            if (!showChoices && gameStarted) {
                // 如果正在打字，直接显示全部文本
                if (isTyping) {
                    clearInterval(typingInterval);
                    typingInterval = null;
                    isTyping = false;
                    document.querySelector('.dialogue-box').textContent = scenes[currentScene].dialogue;
                    
                    // 如果有选择，立即显示
                    if (scenes[currentScene].choices) {
                        showChoices = true;
                        createChoices(scenes[currentScene].choices);
                    }
                    return;
                }
                
                // 检查是否到达结局场景的最后一个场景
                // 好结局、普通结局、友情结局的系统提示场景
                const endScenes = [89, 94, 99];
                if (endScenes.includes(currentScene)) {
                    // 到达结局，显示结局后的选择菜单
                    showEndingChoices();
                    return;
                }
                currentScene++;
                updateScene();
            }
        }
        
        // 显示结局后的选择菜单
        function showEndingChoices() {
            showChoices = true;
            const choices = [
                { text: "重新开始游戏", nextScene: "restart" },
                { text: "回到主菜单", nextScene: "menu" }
            ];
            createEndingChoices(choices);
        }
        
        // 创建结局后的选择按钮
        function createEndingChoices(choices) {
            removeChoices();
            
            const choicesContainer = document.createElement('div');
            choicesContainer.className = 'choices-container';
            
            choices.forEach((choice, index) => {
                const choiceButton = document.createElement('button');
                choiceButton.className = 'choice-button';
                choiceButton.textContent = choice.text;
                choiceButton.onclick = () => {
                    // 记录选择
                    choiceHistory.push({
                        scene: currentScene,
                        choice: index
                    });
                    
                    // 处理结局后的选择
                    if (choice.nextScene === "restart") {
                        // 重新开始游戏
                        restartGame();
                    } else if (choice.nextScene === "menu") {
                        // 回到主菜单
                        returnToMenu();
                    }
                    
                    showChoices = false;
                    removeChoices();
                };
                choicesContainer.appendChild(choiceButton);
            });
            
            document.querySelector('.game-content').appendChild(choicesContainer);
        }
        
        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            currentScene = 0;
            showChoices = false;
            gameStarted = true;
            choiceHistory = [];
            
            // 隐藏开始界面
            const gameStartElement = document.getElementById('gameStart');
            if (gameStartElement) {
                gameStartElement.style.display = 'none';
            }
            
            // 更新场景
            updateScene();
        }
        
        // 回到主菜单
        function returnToMenu() {
            // 重置游戏状态
            currentScene = 0;
            showChoices = false;
            gameStarted = false;
            choiceHistory = [];
            
            // 显示开始界面
            const gameStartElement = document.getElementById('gameStart');
            if (gameStartElement) {
                gameStartElement.style.display = 'flex';
            }
        }
        
        // 移除点击屏幕继续的功能，只允许通过下一句按钮或回车键推进剧情
        
        // 回车键推进剧情
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !showChoices && gameStarted) {
                nextDialogue();
            }
        });
        
        // 初始化游戏
        window.onload = function() {
            updateScene();
            
            // 初始化打字速度滑块
            const typingSpeedSlider = document.getElementById('typingSpeedSlider');
            const typingSpeedValue = document.getElementById('typingSpeedValue');
            
            if (typingSpeedSlider && typingSpeedValue) {
                typingSpeedSlider.addEventListener('input', function() {
                    typingSpeed = parseInt(this.value);
                    typingSpeedValue.textContent = typingSpeed + 'ms';
                });
            }
            
            // 初始化音量滑块
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            
            if (volumeSlider && volumeValue) {
                volumeSlider.addEventListener('input', function() {
                    const volume = parseInt(this.value) / 100;
                    setMusicVolume(volume);
                    volumeValue.textContent = this.value + '%';
                });
            }
            
            // 初始化音乐开关按钮
            const musicToggle = document.getElementById('musicToggle');
            if (musicToggle) {
                updateMusicToggleButton();
            }
            
            // 初始化音乐
            initMusic();
        };
        
        // 更新音乐开关按钮状态
        function updateMusicToggleButton() {
            const musicToggle = document.getElementById('musicToggle');
            if (musicToggle) {
                if (isMusicPlaying) {
                    musicToggle.textContent = '关闭音乐';
                    musicToggle.classList.add('playing');
                } else {
                    musicToggle.textContent = '开启音乐';
                    musicToggle.classList.remove('playing');
                }
            }
        }
        
        // 初始化音乐
        function initMusic() {
            bgMusic = document.getElementById('bgMusic');
            if (bgMusic) {
                bgMusic.volume = musicVolume;
                bgMusic.addEventListener('ended', function() {
                    // 音乐结束时自动播放下一首
                    nextMusic();
                });
                
                if (isMusicPlaying) {
                    bgMusic.play().catch(function(error) {
                        // 自动播放失败时，将音乐设置为暂停状态
                        isMusicPlaying = false;
                        console.log('音乐自动播放失败:', error);
                    });
                }
            }
        }
        
        // 播放/暂停音乐
        function toggleMusic() {
            if (bgMusic) {
                if (isMusicPlaying) {
                    bgMusic.pause();
                    isMusicPlaying = false;
                } else {
                    bgMusic.play().catch(function(error) {
                        console.log('音乐播放失败:', error);
                    });
                    isMusicPlaying = true;
                }
                
                // 更新音乐开关按钮
                updateMusicToggleButton();
            }
        }
        
        // 切换到下一首音乐
        function nextMusic() {
            if (bgMusic) {
                currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
                bgMusic.src = musicList[currentMusicIndex];
                if (isMusicPlaying) {
                    bgMusic.play().catch(function(error) {
                        console.log('音乐播放失败:', error);
                    });
                }
            }
        }
        
        // 切换到上一首音乐
        function prevMusic() {
            if (bgMusic) {
                currentMusicIndex = (currentMusicIndex - 1 + musicList.length) % musicList.length;
                bgMusic.src = musicList[currentMusicIndex];
                if (isMusicPlaying) {
                    bgMusic.play().catch(function(error) {
                        console.log('音乐播放失败:', error);
                    });
                }
            }
        }
        
        // 设置音乐音量
        function setMusicVolume(volume) {
            musicVolume = volume;
            if (bgMusic) {
                bgMusic.volume = volume;
            }
        }
        
        // 设置当前播放的音乐
        function setCurrentMusic(index) {
            if (bgMusic && index >= 0 && index < musicList.length) {
                currentMusicIndex = index;
                bgMusic.src = musicList[currentMusicIndex];
                if (isMusicPlaying) {
                    bgMusic.play().catch(function(error) {
                        console.log('音乐播放失败:', error);
                    });
                }
            }
        }
        
        // 切换设置面板显示
        function toggleSettings() {
            const settingsPanel = document.getElementById('settingsPanel');
            if (settingsPanel) {
                settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        // 保存游戏进度
        function saveGame() {
            const gameData = {
                currentScene,
                choiceHistory,
                typingSpeed,
                gameStarted
            };
            
            localStorage.setItem('acmGameSave', JSON.stringify(gameData));
            alert('游戏已保存！');
        }
        
        // 加载游戏进度
        function loadGame() {
            const savedData = localStorage.getItem('acmGameSave');
            if (savedData) {
                const gameData = JSON.parse(savedData);
                currentScene = gameData.currentScene;
                choiceHistory = gameData.choiceHistory || [];
                typingSpeed = gameData.typingSpeed || 30;
                gameStarted = gameData.gameStarted || false;
                
                // 更新UI
                document.getElementById('typingSpeedSlider').value = typingSpeed;
                document.getElementById('typingSpeedValue').textContent = typingSpeed + 'ms';
                
                if (gameStarted) {
                    const gameStartElement = document.getElementById('gameStart');
                    if (gameStartElement) {
                        gameStartElement.style.display = 'none';
                    }
                }
                
                updateScene();
                alert('游戏已加载！');
            } else {
                alert('没有找到保存的游戏进度！');
            }
        }
    </script>
</body>
</html>